"use strict";
/*!
 * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.createMap = exports.deserialize = exports.serialize = exports.getSerializedSize = exports.getKey = exports.isValid = void 0;
/* tslint:disable variable-name */
const map_1 = require("../map");
const data_view_1 = require("../../data-view");
const utils_1 = require("../../utils");
/**
 * This function takes an object representing an organization from TrackerDB
 * dump and validates its shape. The result is the same object, but strongly
 * typed.
 */
function isValid(organization) {
    if (organization === null) {
        return false;
    }
    if (typeof organization !== 'object') {
        return false;
    }
    const { key, name, description, country, website_url: websiteUrl, privacy_policy_url: privacyPolicyUrl, privacy_contact: privacyContact, ghostery_id: ghosteryId, } = organization;
    if (typeof key !== 'string') {
        return false;
    }
    if (typeof name !== 'string') {
        return false;
    }
    if (description !== null && typeof description !== 'string') {
        return false;
    }
    if (country !== null && typeof country !== 'string') {
        return false;
    }
    if (websiteUrl !== null && typeof websiteUrl !== 'string') {
        return false;
    }
    if (privacyPolicyUrl !== null && typeof privacyPolicyUrl !== 'string') {
        return false;
    }
    if (privacyContact !== null && typeof privacyContact !== 'string') {
        return false;
    }
    if (ghosteryId !== null && typeof ghosteryId !== 'string') {
        return false;
    }
    return true;
}
exports.isValid = isValid;
function getKey(organization) {
    return (0, utils_1.fastHash)(organization.key);
}
exports.getKey = getKey;
function getSerializedSize(organization) {
    return ((0, data_view_1.sizeOfUTF8)(organization.key) +
        (0, data_view_1.sizeOfUTF8)(organization.name) +
        (0, data_view_1.sizeOfUTF8)(organization.description || '') +
        (0, data_view_1.sizeOfUTF8)(organization.website_url || '') +
        (0, data_view_1.sizeOfUTF8)(organization.country || '') +
        (0, data_view_1.sizeOfUTF8)(organization.privacy_policy_url || '') +
        (0, data_view_1.sizeOfUTF8)(organization.privacy_contact || '') +
        (0, data_view_1.sizeOfUTF8)(organization.ghostery_id || ''));
}
exports.getSerializedSize = getSerializedSize;
function serialize(organization, view) {
    view.pushUTF8(organization.key);
    view.pushUTF8(organization.name);
    view.pushUTF8(organization.description || '');
    view.pushUTF8(organization.website_url || '');
    view.pushUTF8(organization.country || '');
    view.pushUTF8(organization.privacy_policy_url || '');
    view.pushUTF8(organization.privacy_contact || '');
    view.pushUTF8(organization.ghostery_id || '');
}
exports.serialize = serialize;
function deserialize(view) {
    return {
        key: view.getUTF8(),
        name: view.getUTF8(),
        description: view.getUTF8() || null,
        website_url: view.getUTF8() || null,
        country: view.getUTF8() || null,
        privacy_policy_url: view.getUTF8() || null,
        privacy_contact: view.getUTF8() || null,
        ghostery_id: view.getUTF8() || null,
    };
}
exports.deserialize = deserialize;
function createMap(organizations) {
    return new map_1.CompactMap({
        getSerializedSize,
        getKeys: (organization) => [getKey(organization)],
        serialize,
        deserialize,
        values: organizations,
    });
}
exports.createMap = createMap;
//# sourceMappingURL=organizations.js.map